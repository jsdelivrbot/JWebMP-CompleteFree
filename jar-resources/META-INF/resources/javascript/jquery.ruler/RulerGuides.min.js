
var RulersGuides=function(B,q){var f=document.documentElement,v=document.body,r=null,k=null,C=1,D=null,R=null,Y=null,z=[],aa=null,a=null,H=0,n=0,h=2,w={},E=0,d="",m=1,g=1,K=0,V=0,u=null,T=0,I=null,x=null,U=0,P=[],A=[],M=null,i=0,y="html,body{margin:0;padding:0}.rg-overlay{position:absolute;top:0;left:0;overflow:hidden}.guide{position:absolute;top:0;left:0;z-index:9991;font-size:0}.guide.v{width:1px;height:7000px;border-right:solid 1px #00f;cursor:col-resize}.guide.h{width:3000px;height:1px;border-bottom:solid 1px #00f;cursor:row-resize}.info{width:50px;height:25px;line-height:25px;text-align:center;position:relative;font-size:13px;background-color:#eee;border:solid 1px #ccc;color:#000}.guide.v .info{left:2px}.guide.h .info{top:2px}.unselectable{-moz-user-select:-moz-none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.ruler{background-color:#ccc;position:absolute;top:0;left:0;z-index:9990}.ruler .label{font:12px Arial;color:#000}.ruler,.ruler span{font-size:0}.ruler.h{width:3000px;left:-1px;padding-top:14px;border-bottom:solid 1px #000}.ruler.v{height:7000px;top:-1px;padding-left:16px;width:25px;border-right:solid 1px #000}.ruler.h span{border-left:solid 1px #999;height:9px;width:1px;vertical-align:bottom;display:inline-block;*display:inline;zoom:1}.ruler.v span{display:block;margin-left:auto;margin-right:0;border-top:solid 1px #999;width:9px;height:1px}.ruler.v span.major{border-top:solid 1px #000;width:13px}.ruler.v span.milestone{position:relative;border-top:solid 1px #000;width:17px}.ruler.v span.label{border:0;font-size:9px;position:absolute;text-align:center;width:9px}.ruler.h span.major{border-left:solid 1px #000;height:13px}.ruler.h span.milestone{position:relative;border-left:solid 1px #000;height:17px}.ruler.h span.label{border:0;font-size:9px;position:absolute;text-align:center;top:-14px;width:9px}.ruler.h .l10{left:-5px}.ruler.h .l100{left:-7px}.ruler.h .l1000{left:-10px}.ruler.v .l10,.ruler.v .l100,.ruler.v .l1000{top:-7px}.ruler.v .l10{left:-12px}.ruler.v .l100{left:-17px}.ruler.v .l1000{left:-23px}.menu-btn{position:fixed;left:3px;top:2px;line-height:9px;z-index:9998;width:20px;height:20px;background-color:red;opacity:.5;font-size:20px;text-align:left;color:#fff;font-weight:700;cursor:pointer;border-radius:2px}.rg-menu{position:fixed;top:22px;left:3px;padding:0;margin:0;list-style:0;display:none;font:13px Arial;z-index:9999;box-shadow:2px 2px 10px #ccc}.rg-menu li{text-align:left;border-bottom:solid 1px #999;padding:0}.rg-menu a{background-color:#777;display:block;padding:5px;text-decoration:none;color:#fff;line-height:18px}.rg-menu a:hover,.rg-menu a.selected{color:#fff;background-color:#3b94ec}.rg-menu a.disabled{color:#ccc}.rg-menu .desc{display:inline-block;width:170px}.dialog{position:fixed;background-color:#777;z-index:9999;color:#fff;font-size:13px;display:none;box-shadow:2px 2px 10px #ccc}.dialog button{border:0;color:#333;cursor:pointer;background-color:#eaeaea;background-image:linear-gradient(#fafafa,#eaeaea);background-repeat:repeat-x;border-radius:3px;text-shadow:0 1px 0 rgba(255,255,255,.9)}.dialog input,.dialog select,.dialog button{font-size:13px;margin:3px;padding:3px}.dialog .title-bar{padding:5px;background-color:#aaa;font-weight:700}.dialog .wrapper{padding:10px}.open-dialog select,.open-dialog button{float:left;display:block}.open-dialog .ok-btn,.open-dialog .cancel-btn{margin:10px 3px}.open-dialog .ok-btn{clear:both}.snap-dialog label{font-weight:700;padding:3px}.snap-dialog .ok-btn{margin-left:18px}.snap-dialog .ok-btn,.snap-dialog .cancel-btn{margin-top:10px}.snap-dialog .rg-y-label{margin-left:10px}#rg-x-snap,#rg-y-snap{width:50px}.info-block-wrapper{position:absolute;z-index:9989}.info-block{position:absolute;text-align:left}.info-block.even{background:0 0;background-color:rgba(0,0,255,.2);-ms-filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#330000FF, endColorstr=#330000FF);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#330000FF, endColorstr=#330000FF);zoom:1}.info-block.odd{background:0 0;background-color:rgba(255,0,0,.2);-ms-filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#33FF0000, endColorstr=#33FF0000);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#33FF0000, endColorstr=#33FF0000);zoom:1}.info-block-txt{padding:5px;display:inline-block;vertical-align:top;background-color:#777;color:#fff;font-size:13px;*display:inline;zoom:1}",X=function(ae,aj){var ai=document.createElement("div"),ac=0,ag=document.createElement("span"),af=null,ah=null,ad=document.createDocumentFragment(),ab=Math.floor(aj/2);ai.className="ruler "+ae+" unselectable";for(ac;ac<ab;ac=ac+1){ag=ag.cloneNode(false);if(ac%25===0){ag.className="milestone";if(ac>0){af=ag.cloneNode(false);af.className="label";if(ac<50){af.className+=" l10"}else{if(ac>=50&&ac<500){af.className+=" l100"}else{if(ac>=500){af.className+=" l1000"}}}ah=document.createTextNode(ac*2);af.appendChild(ah);ag.appendChild(af)}ag.className="milestone"}else{if(ac%5===0){ag.className="major"}else{ag.className="";ag.removeAttribute("class")}}ad.appendChild(ag)}ai.appendChild(ad);return ai},J=function(){var ab=Math.max(v.scrollWidth,v.offsetWidth,f.clientWidth,f.scrollWidth,f.offsetWidth),ac=Math.max(v.scrollHeight,v.offsetHeight,f.clientHeight,f.scrollHeight,f.offsetHeight);return[ab,ac]},s=function(){var ac=Math.max(f.scrollTop,v.scrollTop),ab=Math.max(f.scrollLeft,v.scrollLeft);return[ac,ab]},b=function(){var ab=Math.max(f.scrollWidth,v.scrollWidth),ac=Math.max(f.scrollHeight,v.scrollHeight);return[ab,ac]},F=function(){var ab=0;for(ab;ab<z.length;ab=ab+1){z[ab].close()}},S=function(ab,ad){var ac=s();if(m===1&&g===1&&((ab.className==="guide h draggable"&&ab.offsetTop<K+ac[0])||(ab.className==="guide v draggable"&&ab.offsetLeft<V+ac[1]))){r.removeChild(ab);delete w[ad];E=E-1}},p=function(){var ab;for(ab in w){if(w.hasOwnProperty(ab)){S(w[ab],ab)}}},W=function(){var ab;g=1-g;for(ab in w){if(w.hasOwnProperty(ab)){w[ab].style.display=(g===1)?"block":"none"}}if(g===1){r.style.display="block"}},t=function(){m=1-m;if(m===1){R.style.display="block";D.style.display="block";r.style.display="block";p()}else{R.style.display="none";D.style.display="none"}},o=function(ab){if(u[ab]!==undefined){delete u[ab];window.localStorage.setItem("RulersGuides",JSON.stringify(u));T=T-1}},N=function(){var ab;if(E>0){for(ab in w){if(w.hasOwnProperty(ab)){r.removeChild(w[ab]);delete w[ab];E=E-1}}x.style.display="none"}},c=function(ab){if(u[ab]!==undefined){var ad=u[ab],ae=null,ac=null;N();for(ae in ad){if(ad.hasOwnProperty(ae)){ac=document.createElement("div");ac.id=ae;ac.className=ad[ae].cssClass;ac.style.cssText=ad[ae].style;r.appendChild(ac);w[ae]=ac;E=E+1}}}},L=function(){var ad=null,ac=this,ab=null,ae=function(ai){var af,ag="",ah;T=0;if(window.localStorage){u=JSON.parse(window.localStorage.getItem("RulersGuides"));for(ah in u){if(u.hasOwnProperty(ah)){T=T+1}}}if(ai===0){ab=document.createElement("select");ab.id="grid-list"}if(T>0){for(af in u){if(u.hasOwnProperty(af)){ag+="<option>"+af+"</option>"}}ab.innerHTML=ag}return ab};this.render=function(){if(ad===null){ad=document.createElement("div");ab=ae(0);var am=document.createTextNode(""),ak=ad.cloneNode(false),ah=ad.cloneNode(false),aj=document.createElement("button"),al=aj.cloneNode(false),an=aj.cloneNode(false),ao=am.cloneNode(false),af=am.cloneNode(false),ag=am.cloneNode(false),ai=am.cloneNode(false);ao.nodeValue="Open grid";af.nodeValue="OK";ag.nodeValue="Cancel";ai.nodeValue="Delete";ad.className="dialog open-dialog";ak.className="title-bar";ah.className="wrapper";aj.className="ok-btn";al.className="cancel-btn";an.className="del-btn";ak.appendChild(ao);aj.appendChild(af);al.appendChild(ag);an.appendChild(ai);ah.appendChild(ab);ah.appendChild(an);ah.appendChild(aj);ah.appendChild(al);ad.appendChild(ak);ad.appendChild(ah);v.appendChild(ad);B.attach("click",an,function(){if(window.confirm("Are you sure ?")){if(ab.options.length>0){o(ab.options[ab.selectedIndex].value);ab.removeChild(ab.options[ab.selectedIndex])}if(ab.options.length===0){ac.close()}}});B.attach("click",aj,function(){c(ab.value);ac.close()});B.attach("click",al,function(){ac.close()})}};this.render();this.open=function(){F();ae(1);if(T>0){ad.style.display="block";ad.style.left=((f.clientWidth-ad.clientWidth)/2)+"px";ad.style.top=((f.clientHeight-ad.clientHeight)/2)+"px"}};this.close=function(){ad.style.display="none"}},Q=function(){if(C===0){if(k!==null){B.detach("scroll",window,k)}}else{k=B.attach("scroll",window,function(){var ac=s(),ab=b();D.style.top=ac[0]+"px";r.style.height=ab[1]+"px";R.style.left=ac[1]+"px";r.style.width=ab[0]+"px"})}C=1-C},e=function(){var ae={},ad={},ac,ab="";while(ab===""&&E>0){ab=window.prompt("Save grid as");if(ab!==""&&ab!==false&&ab!==null&&window.localStorage){for(ac in w){if(w.hasOwnProperty(ac)){ad[ac]={cssClass:w[ac].className,style:w[ac].style.cssText}}}if(window.localStorage.getItem("RulersGuides")!==null){ae=JSON.parse(window.localStorage.getItem("RulersGuides"))}ae[ab]=ad;window.localStorage.setItem("RulersGuides",JSON.stringify(ae));T=T+1}}},G=function(){var ai,ah=0,ac=[],aj=[],ab=b(),ag=document.createElement("div"),ak=document.createDocumentFragment(),af=ag.cloneNode(false),am=ag.cloneNode(false),ae=document.createTextNode(""),ad=ae.cloneNode(false),al="",an=document.createElement("br");for(ai in w){if(w.hasOwnProperty(ai)){if(w[ai].type==="h"){ac.push(w[ai].y)}else{aj.push(w[ai].x)}}}aj.unshift(0);aj.push(ab[0]);ac.unshift(0);ac.push(ab[1]);aj=aj.sort(function(ap,ao){return ap-ao});ac=ac.sort(function(ap,ao){return ap-ao});for(ai=0;ai<ac.length-1;ai=ai+1){ah=0;for(ah;ah<aj.length-1;ah=ah+1){af=af.cloneNode(false);am=am.cloneNode(false);ae=ae.cloneNode(false);ad=ad.cloneNode(false);an=an.cloneNode();ag.className="info-block-wrapper";af.className="info-block";am.className="info-block-txt";af.className+=((ai%2!==0&&ah%2!==0)||(ai%2===0&&ah%2===0))?" even":" odd";af.style.top=ac[ai]+"px";af.style.left=aj[ah]+"px";af.style.width=(aj[ah+1]-aj[ah])+"px";af.style.height=(ac[ai+1]-ac[ai])+"px";al=(aj[ah+1]-aj[ah])+" x "+(ac[ai+1]-ac[ai]);ae.nodeValue=al;al=ac[ai]+" : "+aj[ah];ad.nodeValue=al;am.appendChild(ae);am.appendChild(an);am.appendChild(ad);af.appendChild(am);am.style.marginTop=(ai===0)?"31px":"0";am.style.marginLeft=(ah===0)?"42px":"0";ak.appendChild(af)}}ag.appendChild(ak);if(U===1){r.replaceChild(ag,x);x=ag}else{x.style.display="none"}},j=function(){var ac=[],ah=[],ad=[],af=0,ab=P.length,ae=function(am){var ak=0,aj=0,ai=am.offsetWidth,al=am.offsetHeight;while(am){aj+=(am.offsetLeft-am.scrollLeft+am.clientLeft);ak+=(am.offsetTop-am.scrollTop+am.clientTop);am=am.offsetParent}return[aj,ak,aj+ai,ak+al]},ag=function(aj){var am={},al=[],ai=0,ak=aj.length;for(ai;ai<ak;ai=ai+1){if(am.hasOwnProperty(aj[ai])===false){al.push(aj[ai]);am[aj[ai]]=1}}return al};for(af;af<ab;af=af+1){ad=ae(P[af]);ac.push(ad[0]);ac.push(ad[2]);ah.push(ad[1]);ah.push(ad[3])}ac=ag(ac).sort(function(aj,ai){return aj-ai});ah=ag(ah).sort(function(aj,ai){return aj-ai});return[ac,ah]},O=function(){var af=null,ab=0,ae={},ac=[{text:"Hide rulers",hotkey:"Ctrl + Alt + R",alias:"rulers"},{text:"Hide guides",hotkey:"Ctrl + Alt + G",alias:"guides"},{text:"Hide all",hotkey:"Ctrl + Alt + A",alias:"all"},{text:"Unlock rulers",hotkey:"Ctrl + Alt + L",alias:"lock"},{text:"Clear all guides",hotkey:"Ctrl + Alt + D",alias:"clear"},{text:"Open grid",hotkey:"Ctrl + Alt + O",alias:"open"},{text:"Save grid",hotkey:"Ctrl + Alt + G",alias:"save"},{text:"Snap to",hotkey:"Ctrl + Alt + C",alias:"snap"},{text:"Show detailed info",hotkey:"Ctrl + Alt + I",alias:"details"},{text:"Snap to DOM",hotkey:"Ctrl + Alt + E",alias:"snapdom"}],ad=0;this.render=function(){I=document.createElement("div");I.className="menu-btn unselectable";I.appendChild(document.createTextNode("\u250C"));af=document.createElement("ul");af.className="rg-menu";var aj=document.createDocumentFragment(),ah=document.createElement("li"),am=document.createElement("a"),ai=document.createElement("span"),al=ai.cloneNode(false),ak=document.createTextNode(""),ag=ak.cloneNode(false);am.href="javascript:";ai.className="desc";al.className="hotkey";for(ad;ad<ac.length;ad=ad+1){ah=ah.cloneNode(false);am=am.cloneNode(false);ai=ai.cloneNode(false);al=al.cloneNode(false);ak=ak.cloneNode(false);ag=ag.cloneNode(false);ak.nodeValue=ac[ad].text;ag.nodeValue=ac[ad].hotkey;ai.appendChild(ak);al.appendChild(ag);am.appendChild(ai);am.appendChild(al);ah.appendChild(am);aj.appendChild(ah);ae[ac[ad].alias]={obj:am,txt:ak}}B.attach("mousedown",ae.rulers.obj,function(){t()});B.attach("mousedown",ae.guides.obj,function(){W()});B.attach("mousedown",ae.all.obj,function(){if(m===1||g===1){m=g=1;r.style.display="none"}else{m=g=0;r.style.display="block"}t();W()});B.attach("mousedown",ae.lock.obj,function(){Q()});B.attach("mousedown",ae.clear.obj,function(){N()});B.attach("mousedown",ae.open.obj,function(){a.open()});B.attach("mousedown",ae.save.obj,function(){e()});B.attach("mousedown",ae.snap.obj,function(){aa.open()});B.attach("mousedown",ae.details.obj,function(){U=1-U;G()});B.attach("mousedown",ae.snapdom.obj,function(){i=1-i;if(i===1){A=j()}});af.appendChild(aj);v.appendChild(I);v.appendChild(af);B.attach("mousedown",I,function(){ae.rulers.txt.nodeValue=(m===1)?"Hide rulers":"Show rulers";if(E>0){ae.guides.obj.className="";ae.clear.obj.className="";ae.save.obj.className="";ae.guides.txt.nodeValue=(g===1)?"Hide guides":"Show guides"}else{ae.guides.obj.className="disabled";ae.clear.obj.className="disabled";ae.save.obj.className="disabled"}ae.all.txt.nodeValue=(m===1||g===1)?"Hide all":"Show all";ae.lock.txt.nodeValue=(C===0)?"Lock rulers":"Unlock rulers";ae.details.txt.nodeValue=(U===0)?"Show detailed info":"Hide detailed info";ae.snapdom.txt.nodeValue=(i===0)?"Snap to DOM":"Turn off snap to DOM";ae.open.obj.className=(T>0)?"":"disabled";af.style.display=(ab===0)?"inline-block":"none";ab=1-ab})};this.render();this.close=function(){if(af!==null){af.style.display="none";ab=0}}},l=function(){var ad=null,ab=null,ae=null,ac=this;this.render=function(){if(ad===null){ad=document.createElement("div");ab=document.createElement("input");ae=ab.cloneNode(false);var at=document.createTextNode(""),an=document.createElement("button"),ah=document.createElement("label"),ap=ad.cloneNode(false),ak=ad.cloneNode(false),ar=ad.cloneNode(false),al=ad.cloneNode(false),ao=an.cloneNode(false),aq=an.cloneNode(false),am=ah.cloneNode(false),av=at.cloneNode(false),aj=at.cloneNode(false),au=at.cloneNode(false),af=at.cloneNode(false),ag=at.cloneNode(false),ai=at.cloneNode(false);av.nodeValue="Snap guides to";aj.nodeValue="X";au.nodeValue="Y";af.nodeValue="OK";ag.nodeValue="Reset";ai.nodeValue="Cancel";ad.className="dialog snap-dialog";ap.className="title-bar";ak.className="wrapper";ah.className="rg-x-label";ah.setAttribute("for","rg-x-snap");am.className="rg-y-label";am.setAttribute("for","rg-y-snap");ab.setAttribute("type","number");ab.value="100";ab.id="rg-x-snap";ab.setAttribute("type","number");ae.value="100";ae.id="rg-y-snap";an.className="ok-btn";ao.className="reset-btn";aq.className="cancel-btn";ap.appendChild(av);ah.appendChild(aj);am.appendChild(au);an.appendChild(af);ao.appendChild(ag);aq.appendChild(ai);ar.appendChild(ah);ar.appendChild(ab);ar.appendChild(am);ar.appendChild(ae);ar.appendChild(ao);al.appendChild(an);al.appendChild(aq);ak.appendChild(ar);ak.appendChild(al);ad.appendChild(ap);ad.appendChild(ak);v.appendChild(ad);B.attach("mousedown",an,function(){H=parseInt(ab.value,10);n=parseInt(ae.value,10);ac.close()});B.attach("mousedown",ao,function(){H=0;n=0;ac.close()});B.attach("mousedown",aq,function(){ac.close()})}};this.render();this.open=function(){F();ad.style.display="block";ad.style.left=((f.clientWidth-ad.clientWidth)/2)+"px";ad.style.top=((f.clientHeight-ad.clientHeight)/2)+"px"};this.close=function(){ad.style.display="none"}},Z=function(){var ae=document.createElement("style"),ad=J(),af=document.getElementsByTagName("*"),ab=af.length,ac=0;for(ac;ac<ab;ac=ac+1){P.push(af[ac])}ae.setAttribute("type","text/css");if(ae.styleSheet){ae.styleSheet.cssText=y}else{ae.appendChild(document.createTextNode(y))}v.appendChild(ae);setTimeout(function(){D=new X("h",3000);R=new X("v",7000);r=document.createElement("div");x=r.cloneNode(false);r.className="rg-overlay";x.className="info-block-wrapper";r.style.width=(ad[0])+"px";r.style.height=(ad[1])+"px";r.appendChild(D);r.appendChild(R);r.appendChild(x);v.appendChild(r);A=j();Y=new O();aa=new l();a=new L();z=[aa,a]},10)};Z();this.status=1;this.disable=function(){if(R!==null){N();R.style.display="none";D.style.display="none";r.style.display="none";I.style.display="none"}m=0;this.status=0};this.enable=function(){if(R!==null){R.style.display="block";D.style.display="block";r.style.display="block";I.style.display="block"}m=1;this.status=1};B.attach("mousedown",document,function(ah,ab){var aj=ah.clientX,ai=ah.clientY,af=null,ad=null,ac=null,ae=s(),ag=0;if(ab.className.indexOf("menu-btn")===-1){Y.close()}if(V===0){V=R.offsetWidth;K=D.offsetHeight}if(((aj>V&&ai<K)||(ai>K&&aj<V))&&m===1){af=document.createElement("div");ad=af.cloneNode(false);ac=document.createTextNode("");d="guide-"+E;ad.className="info";ad.appendChild(ac);af.appendChild(ad);if(aj>V&&ai<K){af.className="guide h draggable";af.style.top=(ah.clientY+ae[0])+"px";ad.style.left=(aj+ae[1]+10)+"px";af.type="h";ag=n;h=2}else{if(ai>K&&aj<V){af.className="guide v draggable";af.style.left=(aj+ae[1])+"px";ad.style.top=((ai+ae[0])-35)+"px";af.type="v";ag=H;h=1}}af.id=d;af.info=ad;af.text=ac;af.x=0;af.y=0;w[d]=af;r.appendChild(af);q.set(af,{mode:h,onstart:function(ak){var al=(ak.mode===1)?parseInt(ak.style.left,10)+2:parseInt(ak.style.top,10)+2;ak.text.nodeValue=al+"px";if(ak.over!==undefined){B.detach("mouseover",ak,ak.over);B.detach("mouseout",ak,ak.out)}},onmove:function(am){var ao="",ap=0,an=[],ak=0,al=0;ap=(am.mode===1)?am.style.left:am.style.top;ap=parseInt(ap,10);if(i===1){an=A[am.mode-1];for(al,ak=an.length;al<ak;al=al+1){if(ap<=an[al]){ap=an[al];break}}}ao=ap+"px";if(am.mode===1){am.style.left=(ap-2)+"px";am.x=ap}else{am.style.top=(ap-2)+"px";am.y=ap}am.text.nodeValue=ao},onstop:function(ak){ak.over=B.attach("mouseover",ak,function(al,am){if(am.className==="guide v draggable"){ak.info.style.top=((al.clientY+ae[0])-35)+"px"}else{if(am.className==="guide h draggable"){ak.info.style.left=(al.clientX+ae[1]+10)+"px"}}ak.info.style.display="block"});ak.out=B.attach("mouseout",ak,function(){ak.info.style.display="none"})},snap:ag});q.start(ah,af);E=E+1}});B.attach("mouseup",document,function(ab,ac){S(ac,ac.id);if(U===1){G()}});B.attach("keyup",document,function(ab){if(ab.ctrlKey===true&&ab.altKey===true){switch(ab.keyCode){case 83:e();break;case 82:t();break;case 79:a.open();break;case 76:Q();break;case 73:U=1-U;G();break;case 71:W();break;case 69:i=1-i;if(i===1){A=j()}break;case 68:N();break;case 67:aa.open();break;case 65:if(m===1||g===1){m=g=1;r.style.display="none"}else{m=g=0;r.style.display="block"}t();W();break}}});B.attach("resize",window,function(){var ab=J();r.style.width=ab[0]+"px";r.style.height=ab[1]+"px";if(M!==null){window.clearTimeout(M)}if(i===1){M=window.setTimeout(function(){A=j()},100)}})};