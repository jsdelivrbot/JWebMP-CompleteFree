
(function(e){if(!e.event.special.destroyed){e.event.special.destroyed={remove:function(i){if(i.handler){i.handler()}}}}function f(i,j){return i.position-j.position}function h(j,i){if(typeof j.bind==="function"){return j.bind(i)}else{return function(){j.apply(i,arguments)}}}var d="";if(e.browser.mozilla){d="-moz-"}else{if(e.browser.webkit){d="-webkit-"}else{if(e.browser.opera){d="-o-"}else{if(e.browser.msie){d="-ms-"}}}}function g(m,n){this.$el=m;this.$el.css("position","relative");this.opts=n;var o=e("<canvas class='gradientPicker-preview'></canvas>");this.$el.append(o);var k=o[0];k.width=k.clientWidth;k.height=k.clientHeight;this.g2d=k.getContext("2d");var p=e("<div class='gradientPicker-ctrlPts'></div>");this.$el.append(p);this.$ctrlPtContainer=p;this.updatePreview=h(this.updatePreview,this);this.controlPoints=[];this.ctrlPtConfig=new c(this.$el,n);for(var l=0;l<n.controlPoints.length;++l){var j=this.createCtrlPt(n.controlPoints[l]);this.controlPoints.push(j)}this.docClicked=h(this.docClicked,this);this.destroyed=h(this.destroyed,this);e(document).bind("click",this.docClicked);this.$el.bind("destroyed",this.destroyed);this.previewClicked=h(this.previewClicked,this);o.click(this.previewClicked);this.updatePreview()}g.prototype={docClicked:function(){this.ctrlPtConfig.hide()},createCtrlPt:function(i){return new b(this.$ctrlPtContainer,i,this.opts.orientation,this,this.ctrlPtConfig)},destroyed:function(){e(document).unbind("click",this.docClicked)},updateOptions:function(i){e.extend(this.opts,i);this.updatePreview()},updatePreview:function(){var j=[];this.controlPoints.sort(f);if(this.opts.orientation=="horizontal"){var n=this.g2d.createLinearGradient(0,0,this.g2d.canvas.width,0);for(var k=0;k<this.controlPoints.length;++k){var m=this.controlPoints[k];n.addColorStop(m.position,m.color);j.push({position:m.position,color:m.color})}}else{}this.g2d.fillStyle=n;this.g2d.fillRect(0,0,this.g2d.canvas.width,this.g2d.canvas.height);if(this.opts.generateStyles){var l=this._generatePreviewStyles()}this.opts.change(j,l)},removeControlPoint:function(i){var j=this.controlPoints.indexOf(i);if(j!=-1){this.controlPoints.splice(j,1);i.$el.remove()}},previewClicked:function(m){var n=e(m.target).offset();var i=m.pageX-n.left;var o=m.pageY-n.top;var l=this.g2d.getImageData(i,o,1,1);var j="rgb("+l.data[0]+","+l.data[1]+","+l.data[2]+")";var k=this.createCtrlPt({position:i/this.g2d.canvas.width,color:j});this.controlPoints.push(k);this.controlPoints.sort(f)},_generatePreviewStyles:function(){var n=this.opts.type+"-gradient("+((this.opts.type=="linear")?(this.opts.fillDirection+", "):"");var m=true;for(var j=0;j<this.controlPoints.length;++j){var l=this.controlPoints[j];if(!m){n+=", "}else{m=false}n+=l.color+" "+((l.position*100)|0)+"%"}n=n+")";var k=[n,d+n];return k}};function b(l,i,k,m,j){this.$el=e("<div class='gradientPicker-ctrlPt'></div>");l.append(this.$el);this.$parentEl=l;this.configView=j;if(typeof i==="string"){i=i.split(" ");this.position=parseFloat(i[1])/100;this.color=i[0]}else{this.position=i.position;this.color=i.color}this.listener=m;this.outerWidth=this.$el.outerWidth();this.$el.css("background-color",this.color);if(k=="horizontal"){var o=(l.width()-this.$el.outerWidth())*(this.position);this.$el.css("left",o)}else{var n=(l.height()-this.$el.outerHeight())*(this.position);this.$el.css("top",n)}this.drag=h(this.drag,this);this.stop=h(this.stop,this);this.clicked=h(this.clicked,this);this.colorChanged=h(this.colorChanged,this);this.$el.draggable({axis:(k=="horizontal")?"x":"y",drag:this.drag,stop:this.stop,containment:l});this.$el.click(this.clicked)}b.prototype={drag:function(k,i){var j=i.position.left;this.position=(j/(this.$parentEl.width()-this.outerWidth));this.listener.updatePreview()},stop:function(j,i){this.listener.updatePreview();this.configView.show(this.$el.position(),this.color,this)},clicked:function(i){this.configView.show(this.$el.position(),this.color,this);i.stopPropagation();return false},colorChanged:function(i){this.color=i;this.$el.css("background-color",this.color);this.listener.updatePreview()},removeClicked:function(){this.listener.removeControlPoint(this);this.listener.updatePreview()}};function c(l,k){this.$el=e('<div class="gradientPicker-ptConfig" style="visibility: hidden"></div>');l.append(this.$el);var i=e('<div class="color-chooser"></div>');this.$el.append(i);var j=e("<div class='gradientPicker-close'></div>");this.$el.append(j);this.colorChanged=h(this.colorChanged,this);this.removeClicked=h(this.removeClicked,this);i.ColorPicker({onChange:this.colorChanged});this.$cpicker=i;this.opts=k;this.visible=false;j.click(this.removeClicked)}c.prototype={show:function(i,j,k){this.visible=true;this.listener=k;this.$el.css("visibility","visible");this.$cpicker.ColorPickerSetColor(j);this.$cpicker.css("background-color",j);if(this.opts.orientation==="horizontal"){this.$el.css("left",i.left)}else{this.$el.css("top",i.top)}},hide:function(){if(this.visible){this.$el.css("visibility","hidden");this.visible=false}},colorChanged:function(i,k,j){k="#"+k;this.listener.colorChanged(k);this.$cpicker.css("background-color",k)},removeClicked:function(){this.listener.removeClicked();this.hide()}};var a={init:function(i){i=e.extend({controlPoints:["#FFF 0%","#000 100%"],orientation:"horizontal",type:"linear",fillDirection:"left",generateStyles:true,change:function(){}},i);this.each(function(){var k=e(this);var j=new g(k,i);k.data("gradientPicker-sel",j)})},update:function(i){this.each(function(){var k=e(this);var j=k.data("gradientPicker-sel");if(j!=null){j.updateOptions(i)}})}};e.fn.gradientPicker=function(j,i){if(typeof j==="string"&&j!=="init"){a[j].call(this,i)}else{i=j;a.init.call(this,i)}}})(jQuery);