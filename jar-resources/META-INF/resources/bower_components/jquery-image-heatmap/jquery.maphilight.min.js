
(function(g){var b,k,c,l,o,n,j,e,h,a,m;b=document.namespaces;k=!!document.createElement("canvas").getContext;if(!(k||b)){g.fn.maphilight=function(){return this};return}if(k){e=function(p){return Math.max(0,Math.min(parseInt(p,16),255))};h=function(p,q){return"rgba("+e(p.substr(0,2))+","+e(p.substr(2,2))+","+e(p.substr(4,2))+","+q+")"};c=function(p){var q=g('<canvas style="width:'+p.width+"px;height:"+p.height+'px;"></canvas>').get(0);q.getContext("2d").clearRect(0,0,q.width,q.height);return q};var f=function(r,p,s,q,t){q=q||0;t=t||0;r.beginPath();if(p=="rect"){r.rect(s[0]+q,s[1]+t,s[2]-s[0],s[3]-s[1])}else{if(p=="poly"){r.moveTo(s[0]+q,s[1]+t);for(i=2;i<s.length;i+=2){r.lineTo(s[i]+q,s[i+1]+t)}}else{if(p=="circ"){r.arc(s[0]+q,s[1]+t,s[2],0,Math.PI*2,false)}}}r.closePath()};l=function(r,u,v,y,p){var t,q=r.getContext("2d");if(y.shadow){q.save();if(y.shadowPosition=="inside"){f(q,u,v);q.clip()}var s=r.width*100;var x=r.height*100;f(q,u,v,s,x);q.shadowOffsetX=y.shadowX-s;q.shadowOffsetY=y.shadowY-x;q.shadowBlur=y.shadowRadius;q.shadowColor=h(y.shadowColor,y.shadowOpacity);var w=y.shadowFrom;if(!w){if(y.shadowPosition=="outside"){w="fill"}else{w="stroke"}}if(w=="stroke"){q.strokeStyle="rgba(0,0,0,1)";q.stroke()}else{if(w=="fill"){q.fillStyle="rgba(0,0,0,1)";q.fill()}}q.restore();if(y.shadowPosition=="outside"){q.save();f(q,u,v);q.globalCompositeOperation="destination-out";q.fillStyle="rgba(0,0,0,1);";q.fill();q.restore()}}q.save();f(q,u,v);if(y.fill){q.fillStyle=h(y.fillColor,y.fillOpacity);q.fill()}if(y.stroke){q.strokeStyle=h(y.strokeColor,y.strokeOpacity);q.lineWidth=y.strokeWidth;q.stroke()}q.restore();if(y.fade){g(r).css("opacity",0).animate({opacity:1},100)}};o=function(p){p.getContext("2d").clearRect(0,0,p.width,p.height)}}else{c=function(p){return g('<var style="zoom:1;overflow:hidden;display:block;width:'+p.width+"px;height:"+p.height+'px;"></var>').get(0)};l=function(q,t,u,x,p){var v,w,r,s;v='<v:fill color="#'+x.fillColor+'" opacity="'+(x.fill?x.fillOpacity:0)+'" />';w=(x.stroke?'strokeweight="'+x.strokeWidth+'" stroked="t" strokecolor="#'+x.strokeColor+'"':'stroked="f"');r='<v:stroke opacity="'+x.strokeOpacity+'"/>';if(t=="rect"){s=g('<v:rect name="'+p+'" filled="t" '+w+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+u[0]+"px;top:"+u[1]+"px;width:"+(u[2]-u[0])+"px;height:"+(u[3]-u[1])+'px;"></v:rect>')}else{if(t=="poly"){s=g('<v:shape name="'+p+'" filled="t" '+w+' coordorigin="0,0" coordsize="'+q.width+","+q.height+'" path="m '+u[0]+","+u[1]+" l "+u.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+q.width+"px;height:"+q.height+'px;"></v:shape>')}else{if(t=="circ"){s=g('<v:oval name="'+p+'" filled="t" '+w+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(u[0]-u[2])+"px;top:"+(u[1]-u[2])+"px;width:"+(u[2]*2)+"px;height:"+(u[2]*2)+'px;"></v:oval>')}}}s.get(0).innerHTML=v+r;g(q).append(s)};o=function(p){g(p).find("[name=highlighted]").remove()}}n=function(q){var p,r=q.getAttribute("coords").split(",");for(p=0;p<r.length;p++){r[p]=parseFloat(r[p])}return[q.getAttribute("shape").toLowerCase().substr(0,4),r]};m=function(r,q){var p=g(r);return g.extend({},q,g.metadata?p.metadata():false,p.data("maphilight"))};a=function(p){if(!p.complete){return false}if(typeof p.naturalWidth!="undefined"&&p.naturalWidth==0){return false}return true};j={position:"absolute",left:0,top:0,padding:0,border:0};var d=false;g.fn.mapPrep=function(r){var p;p=g(this);var q,s;if(p.attr("width")){q=p.attr("width")}else{q=p.width}if(p.attr("height")){s=p.attr("height")}else{s=p.height}p.height(s);p.width(q)};g.fn.maphilight=function(t){var s=Array.prototype.slice;var q=s.call(arguments);t=g.extend({},g.fn.maphilight.defaults,t);if(!k&&g.browser.msie&&!d){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var r=document.createStyleSheet();var p=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];g.each(p,function(){r.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")});d=true}return this.each(function(){var A,x,H,w,z,C,E,y,D;var v;var G;A=g(this);if(!a(this)){return window.setTimeout(function(){A.maphilight(t)},200)}H=g.extend({},t,g.metadata?A.metadata():false,A.data("maphilight"));D=A.get(0).getAttribute("usemap");w=g('map[name="'+D.substr(1)+'"]');var F,B;if(A.attr("width")){F=A.attr("width")}else{F=A.width}if(A.attr("height")){B=A.attr("height")}else{B=A.height}A.height(B);A.width(F);if(!(A.is("img")&&D&&w.size()>0)){return}if(A.hasClass("maphilighted")){var u=A.parent();A.insertBefore(u);u.remove();g(w).unbind(".maphilight").find("area[coords]").unbind(".maphilight")}x=g("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:F,height:B});if(H.wrapClass){if(H.wrapClass===true){x.addClass(g(this).attr("class"))}else{x.addClass(H.wrapClass)}}A.before(x).css("opacity",0).css(j).remove();if(g.browser.msie){A.css("filter","Alpha(opacity=0)")}x.append(A);z=c(this);g(z).css(j);z.height=this.height;z.width=this.width;v=c(this);g(v).css(j);v.height=this.height;v.width=this.width;G=c(this);g(G).css(j);G.height=this.height;G.width=this.width;E=function(M){var K,L;L=m(this,H);if(!L.neverOn&&!L.alwaysOn){K=n(this);l(z,K[0],K[1],L,"highlighted");if(L.groupBy){var J;var I=L.groupBy;if(/^[a-zA-Z][-a-zA-Z]+$/.test(L.groupBy)){J=w.find("area")}else{}var N=this;J.each(function(){var P=m(this,H);if(P.groupBy){if(this!=N){var O=n(this);l(z,O[0],O[1],P,"highlighted")}}})}if(!k){g(z).append("<v:rect></v:rect>")}}};click=function(M){o(G);var K,L;L=m(this,H);K=n(this);l(G,K[0],K[1],L,"highlighted");if(L.groupBy){var J;var I=L.groupBy;if(/^[a-zA-Z][-a-zA-Z]+$/.test(L.groupBy)){J=w.find("area")}else{}var N=this;J.each(function(){var P=m(this,H);if(P.groupBy){if(this!=N){var O=n(this);l(G,O[0],O[1],P,"highlighted")}}})}if(!k){g(z).append("<v:rect></v:rect>")}};g(w).bind("alwaysHaveOn",function(){g(w).find("area[coords]").each(function(){var I,J;J=m(this,H);J.fillColor=J.overlayColorPermanent;J.strokeWidth=0;J.strokeColor="000000";J.fillOpacity=J.overlayColorOpacity;I=n(this);if(!(J.fillColor==="transparent")){l(v,I[0],I[1],J,"");l(v,I[0],I[1],J,"")}});A.before(v)});g(w).bind("alwaysOn.maphilight",function(){if(C){o(C)}if(!k){g(z).empty()}g(w).find("area[coords]").each(function(){var I,J;J=m(this,H);if(J.alwaysOn){if(!C&&k){C=c(A.get());g(C).css(j);C.width=A.width();C.height=A.height();A.before(C)}J.fade=J.alwaysOnFade;I=n(this);l(C,I[0],I[1],J,"");l(z,I[0],I[1],J,"")}})});g(w).trigger("alwaysHaveOn").find("area[coords]");g(w).trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",E).bind("click.maphilight",click).bind("mouseout.maphilight",function(I){o(z)});A.before(z);A.before(G);A.addClass("maphilighted")})};g.fn.maphilight.defaults={fill:true,fillColor:"000000",fillOpacity:0.4,stroke:true,strokeColor:"000000",strokeOpacity:1,strokeWidth:1,fade:true,alwaysOn:false,neverOn:false,groupBy:false,wrapClass:true,shadow:false,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:0.8,shadowPosition:"outside",shadowFrom:false,overlayColorPermanent:"transparent",overlayColorOpacity:1,attName:"8D679D4B11D3E4981000E787EC6DE8A4",attName2:"attribute2",boneId:"no bone"}})(jQuery);